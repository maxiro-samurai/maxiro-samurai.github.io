---
title: 差分放大
date: 2025-03-17 20:38:56
mathjax: true
categories:
  - 硬件
  - 模电
tags:
---

# 差分放大
我们日常使用的信号源一般是两根线传输，一个地线，一根是信号线，这种信号叫做单端信号。
单端信号在远距离传输过程中，不可避免的要受到外界电场的干扰，而差分信号抗干扰性很强。

定义1：差分信号中两个信号线之间的差值信号，用u<sub>D</sub>表示：$u_D = u_{s+}-u_{s-}$

定义2：差分信号中两个信号线共有的信号，称为共模信号，用u<sub>C</sub>表示：$u_C = 0.5（u_{s+}+u_{s-}）$

在远距离传输过程中，因为两根线两根线距离很近，两根线都收到了相同的外界干扰。此时，差模信号是待测的有用信号，而共模信号是干扰。如果有一个差动放大器，他有两个输入端和两个输出端，而真正有意义的输出是两个输出端的差值。

## 差动放大器
先在仿真软件中模拟出差模和共模信号，电路图如下所示：

![image](https://github.com/maxiro-samurai/picx-images-hosting/raw/master/image.2vewiworjx.webp)

信号源通过两个压控电压源（放大倍数均为0.5）正极输出和负极输出模拟差分信号，共模信号接在两个压控电压源之间。则

$$
\begin{align*}\left\{\begin{aligned}u_{S+} &= u_1 + 0.5u_D \\u_{S-} &= u_1 - 0.5u_D\end{aligned}\right.\end{align*}
$$

当关闭共模信号输入时可以用示波器看到，输入与差分信号的关系：

![image](https://github.com/maxiro-samurai/picx-images-hosting/raw/master/image.26lmzwu1ma.webp)
每一路信号都是输入信号的0.5倍，VF2是VF3的反相信号，$VF3-VF2$正好是原信号

当接入共模信号时，可以看到每一路差分信号都是在共模信号的基础上叠加的。
![image](https://github.com/maxiro-samurai/picx-images-hosting/raw/master/image.8z6omdpalg.webp)

假设我们可以造出一个放大器，它能够实现分别放大两路差分信号，最后再把两个输出信号相减得到放大的有用信号。

差动放大电路如下图所示：
![image](https://github.com/maxiro-samurai/picx-images-hosting/raw/master/image.6t7a0n2yc1.webp)

我们用示波器看Vin+和Vout+的结果，看信号是否被放大

![image](https://github.com/maxiro-samurai/picx-images-hosting/raw/master/image.6bh8c2a0c5.webp)

Vout+信号是Vin+放大后的结果，但是又有点奇怪，因为我们还没有对Vout+和Vout-相减，它的输出就已经没有共模信号了，这是为什么？这正与我们期望的一样，我们希望差动放大电路可以放大差模信号，抑制共模信号。下面是理论分析：

因为电路是线性电路，符合叠加原理，我们只看共模信号输入。首先按照分析步骤，先进行静态分析确定I<sub>BQ1</sub>，假设两边电路对称，只分析Q1管子：

$$
I_{B01}R_{B1} + 0.7\,\text{V} + 2(1 + \beta)I_{B01}R_E = 0\,\text{V} - (-V_{EE}) = 12\,\text{V}
$$
解出$I_{BQ1} = 55.67μA$，$r_{be1}≈\frac{U_T}{I_{BQ1}}=0.467kΩ$

动态分析我们直接不画动态等效图了，开始脑内脑补，基极电阻就只有RB1和r<sub>be</sub>，需要注意发射极是两个管子射极电流并入到一个RE中，所以：

$$i_{b\_com} = \frac{V_{com}}{R_{B1} + r_{be} + 2(1 + \beta)R_E}$$

$$u_{out+com} = -βi_{b\_com}R_{C1}$$


得到单端共模放大倍数：
$$A_{C \text{单}} = \frac{u_{O+\_com}}{V_{com}} = -\frac{\beta R_{C1}}{R_{B1} + r_{be} + 2(1 + \beta)R_E} = -\frac{100\,\text{k}\Omega}{203.467\,\text{k}\Omega} = -0.49$$

即共模信号被抑制。


差模信号，假设Vin+有一个微小的电压增量，引起基极电流i<sub>b1</sub>变化，而电路对称所以另一个管子也有一个变化量，在发射极两个管子引起的变化正好大小相等方向相反，在动态分析中可以把两个管子的发射极看做接地（电压不变点）。

$$i_{b\_diff} = \frac{V_{diff} - V_{diff,N}}{2(R_{B1} + r_{be})} = \frac{V_{diff}}{2(R_{B1} + r_{be})}$$
$$u_{0+\_dif} = -\beta i_{b\_diff} R_{C1}$$
$$u_{0-\_dif} = \beta i_{b\_diff} R_{C1}$$
$$A_D \text{单} = \frac{u_{0+\_dif}}{V_{diff}} = -\frac{\beta R_{C1}}{2(R_{B1} + r_{be})} = -\frac{100\,\text{k}\Omega}{2.934\,\text{k}\Omega} = -34.08$$

两个输出信号反向，如果我们差分输出可得：

$$A_D \text{双} = \frac{u_{O+\_diff} - u_{O-\_diff}}{V_{\text{diff}}} = -\frac{\beta R_{C1}}{R_{B1} + r_{be}} = -68.17$$


## 带负载

静态分析中，两个输出端电位相等，所以接入R<sub>load</sub>不会对原静态电路造成影响。

动态分析中。共模信号同理不会对原结果造成影响，不包含R<sub>load</sub>。

对于差模信号，仅在输出端改变。原动态等效图：
![image](https://github.com/maxiro-samurai/picx-images-hosting/raw/master/image.2h8guj03ip.webp)

动态分析中要熟练运用电压不变点看做接地，这一技巧，当仅有Vin+输入时，在Vout+引起电压变化+u，Vout-电压不变看做接地，即在R<sub>load</sub>左端有电压变化，同理Vin-输入时，在右端有电压变化-u。而在R<sub>load</sub>中间点处正负变化抵消，时电压不变点。因此等效电路图：

![image](https://github.com/maxiro-samurai/picx-images-hosting/raw/master/image.4qrhe0vwfo.webp)

解得：
$$u_{out+} = -βi_b(R_c//0.5R_{load})$$

$$A_D \text{单} = \frac{u_{O+\_diff}}{V_{diff}} = -\frac{\beta(R_C // 0.5R_{load})}{2(R_{B1} + r_{be})} = -\frac{33.33k\Omega}{2.934k\Omega} = -11.36\$$

$$A_D \text{双} = \frac{u_{O+\_diff} - u_{O-\_diff}}{V_{diff}} = -\frac{\beta(R_C // 0.5R_{load})}{R_{B1} + r_{be}}$$

与不带负载时的区别是，在分子上并联了一个0.5R<sub>load</sub>。


### 单端带载

首先静态会影响，输出端多了一个R<sub>load</sub>分流。

![image](https://github.com/maxiro-samurai/picx-images-hosting/raw/master/image.6bh8din521.webp)


$$U_{CQ1} = \frac{V_{CC} R_{\text{load}} - I_{CQ1} R_{\text{load}} R_{C1}}{R_{\text{load}} + R_{C1}}$$

$$A_{C \text{单}} = \frac{u_{O+\text{com}}}{V_{\text{com}}} = -\frac{\beta (R_{c1} // R_{\text{load}})}{R_{B1} + r_{be} + 2(1 + \beta)R_E} = -\frac{50k\Omega}{203.467k\Omega} = -0.25$$
$$A_{D \text{单}} = \frac{u_{O+\text{diff}}}{V_{\text{diff}}} = -\frac{\beta (R_{c1} // R_{\text{load}})}{2(R_{B1} + r_{be})} = -\frac{50k\Omega}{2.934k\Omega} = -17.04$$


* 输入电阻：
  1. 差模输入电阻：
    $$r_{iD} = 2(R_{B1}+r_{be})$$
    差模回路的总电阻

  2. 共模输入电阻：
    $$r_{iC} = \frac{R_{B1}+r_{be}+2(1+β)R_E}{2}$$
    左右两侧输入看进去的电阻并联

* 输出电阻：
  1. 单端：
    $$r_{out+} = R_{C1}, r_{out-} = R_{C2}$$
  2. 双端：
    $$r_{oD} =  R_{C1}+R_{C2}$$


## 共模抑制比

定义：差模增益除以共模增益。差模信号放大越大越好，共模信号越小越好。

$$CMRR = \frac{A_D}{A_C}$$

用dB表示：
  $$CMRR = \frac{A_D}{A_C} = 20 \times \log\left(\frac{A_D}{A_C}\right) dB$$

输出若为差分形式，如果电路完全对称，CMRR为无穷大。

输出为单端形式，则将前述分析结果带入：

$$CMRR = \frac{A_D}{A_C} = \frac{-\frac{\beta R_{C1}}{2(R_{B1} + r_{be})}}{\frac{\beta R_{C1}}{-R_{B1} + r_{be} + 2(1 + \beta)R_E}} = \frac{R_{B1} + r_{be} + 2(1 + \beta)R_E}{2(R_{B1} + r_{be})}$$


## 提高CMRR

在前面的例子中CMRR为几十倍，我们在实际生活中往往噪声信号大小比有用信号高了不止几十倍，我们需要更大的CMRR。看CMRR的表达式，只有提高β或者R<sub>E</sub>的值才能提高CMRR，往往β的提高是有限的，而我们如果提高R<sub>E</sub>的值，那么静态工作点也将改变。有没有一种方法，不改变静态I<sub>EQ</sub>，在动态时候可以让R<sub>E</sub>增的十分大。（静态不变，动态电阻增大）

答案是上一节：恒流源电路！

![image](https://github.com/maxiro-samurai/picx-images-hosting/raw/master/image.m8gqsfqo.webp)

这个电路是书本上另一个示例修改的（P150），经过计算和仿真，源电路静态：

$I_{BQ}=35.49μA$

$U_{CQ1} = 10.41V$

$U_{EQ1} = -0.65V$

动态：

$A_{D单} = -42.26$

$A_{C单} = -0.224$

$CMRR = 188.66=45.5dB$

使用恒流源替代RE，并把恒流源静态电流调至与原电路相同。

![image](https://github.com/maxiro-samurai/picx-images-hosting/raw/master/image.5xasnrf5cc.webp)

仿真结果中两个电路静态相差不大，主要看动态结果。

$A_{D单} = -42.61$

$A_{C单} = -0.0736$

$CMRR = 578.94=55.25dB$

加入恒流源对电路的主要影响是对共模信号抑制能力的增加，因为只看差模信号动态分析，不管在加不加恒流源，R<sub>E1</sub>和R<sub>E2</sub>中间为电压不变点，所以不会对差模放大倍数产生影响。

在共模信号动态分析时就产生影响，恒流源表现出极大的动态电阻，图中这个管子在仿真软件中接近于理想三极管，所以VF2电压严格等于共模信号，因为几乎没有电流流过恒流源，最终共模放大倍数得到极大衰减。



## MOSFET恒流源


在差动放大电路中管子全部使用MOSFET，电路如下所示
![image](https://github.com/maxiro-samurai/picx-images-hosting/raw/master/image.6pno61co9m.webp)

因为书中MOS管参数使用multisim仿真，TINA中没有这个参数的管子，这里仿真数值与计算不同，只看分析方法。

* 静态：
  
    电路对称所以I<sub>Q1</sub>与I<sub>Q2</sub>相同，并且流入恒流源中，所以静态几乎是由恒流源的电流决定的。

    求解I<sub>Q3</sub>静态电流：
    $$I_{DQ3} = K (U_{GSQ3} - U_{GSTH})^2$$

    $$U_{GQ3} = \frac{R1}{R1 + R2} (-VEE)$$

    $$U_{GQ3} - VEE = U_{GSQ3} + I_{DQ3} \times RE$$

    联立求解静态参数


* 动态：
    
    恒流源在动态分析中看做开路（看上面分析），并且Q1和Q2管子栅极无电流流入。动态等效如下：

    ![image](https://github.com/maxiro-samurai/picx-images-hosting/raw/master/image.67xmhh2epm.webp)

    $$g_mu_{gs1}+g_mu_{gs2} = 0$$

    $$u_{id} = 2u_{gs1}$$

    $$A_{DX} = \frac{u_o}{u_{id}} = \frac{u_{o1} - u_{o2}}{u_{id}} = \frac{-R_{c1} \times g_m \times u_{gs1} - (-R_{c2} \times g_m \times u_{gs2})}{2u_{gs1}} = -\frac{R_{c1} + R_{c2}}{2}g_m$$


    ## 5个MOSFET


    我们继续改进，在上面的基础上是否还能继续增加差模放大增益，注意观察表达式，增大R<sub>c1</sub>和R<sub>c2</sub>就可以再增加增益。
    类比恒流源，下图为改进后电路

    ![image](https://github.com/maxiro-samurai/picx-images-hosting/raw/master/image.3d4ybqrayk.webp)


    上面的两个PMOS管电路叫做恒流源电流镜，保证了两个管子的静态电流相等。

    我们用电流表量这两个管子上的静态电流，他们是相等的。

    ![image](https://github.com/maxiro-samurai/picx-images-hosting/raw/master/image.13lxs9a1ws.webp)

    使用示波器观察放大波形，如果输出波形失真就调节R<sub>3</sub>，来限制电流，使输出波形正常。

    ![image](https://github.com/maxiro-samurai/picx-images-hosting/raw/master/image.102bujincq.webp)

    交流电压档可以看出，这个电路单端输出电压增益为4150倍